{"version":3,"file":"index.mjs","sources":["../src/useAxiosRequest.ts","../src/useAxiosQuery.ts"],"sourcesContent":["import axios, {\n  AxiosError,\n  AxiosRequestConfig,\n  AxiosResponse,\n  Canceler,\n} from 'axios';\nimport axiosRetry, { IAxiosRetryConfig } from 'axios-retry';\nimport { useCallback, useEffect, useRef } from 'react';\n\nexport const REQUEST_MANUALLY_CANCELLED = 'REQUEST_MANUALLY_CANCELLED';\nexport const REQUEST_AUTOMATICALLY_CANCELLED =\n  'REQUEST_AUTOMATICALLY_CANCELLED';\n\nexport type HookOptions = {\n  authorizationHandler?: (e: AxiosError) => void;\n  cancelAutomatically?: boolean;\n};\n\nexport type RequestGenerator = <TResponseType>(\n  url: string,\n  options?: AxiosRequestConfig\n) => Promise<AxiosResponse<TResponseType>>;\n\nexport type RequestGeneratorWithoutDataOptions = Omit<AxiosRequestConfig, 'data'>;\n\nexport type RequestGeneratorWithData = <TResponseType>(\n  url: string,\n  data: any,\n  options: RequestGeneratorWithoutDataOptions\n) => Promise<AxiosResponse<TResponseType>>;\n\nexport type Axios = {\n  delete: RequestGenerator;\n  get: RequestGenerator;\n  head: RequestGenerator;\n  options: RequestGenerator;\n  patch: RequestGeneratorWithData;\n  post: RequestGeneratorWithData;\n  put: RequestGeneratorWithData;\n};\n\nexport const useAxiosRequest = (\n  axiosOptions: AxiosRequestConfig = {},\n  retryOptions: IAxiosRetryConfig = {},\n  hookOptions: HookOptions = {}\n): [Axios, () => void] => {\n  const mergedHookOptions = {\n    authorizationHandler: null,\n    cancelAutomatically: true,\n    ...hookOptions,\n  };\n\n  const cancelRef = useRef<Canceler[]>([]);\n\n  const canceler = (reason?: string) => {\n    cancelRef.current.forEach((callback: (reason?: string) => void) => {\n      if (typeof callback === 'function') {\n        callback(reason);\n      }\n    });\n  };\n\n  const request = useCallback(\n    <TResponseType>(url: string, method: string, requestOptions: AxiosRequestConfig = {}) =>\n      new Promise<AxiosResponse<TResponseType>>((resolve, reject) => {\n        const { cancel, token } = axios.CancelToken.source();\n        cancelRef.current.push(cancel);\n\n        const instance = axios.create();\n        const { headers, ...otherOptions } = {\n          ...axiosOptions,\n          ...requestOptions,\n        };\n\n        axiosRetry(instance, {\n          ...{\n            retries: 5,\n            retryDelay: (retryCount: number) => retryCount * 3000,\n          },\n          ...retryOptions,\n        });\n\n        instance\n          .request({\n            cancelToken: token,\n            headers: {\n              ...headers,\n            },\n            method,\n            url,\n            withCredentials: true,\n            ...otherOptions,\n          })\n          .then(resolve)\n          .catch((e: AxiosError) => {\n            reject(e);\n\n            if (e && e.response && e.response.status === 401) {\n              const { authorizationHandler } = mergedHookOptions;\n              if (typeof authorizationHandler === 'function') {\n                authorizationHandler(e);\n              }\n            }\n          });\n      }),\n    []\n  );\n\n  const generators: Axios = {\n    delete: <TResponseType>(url: string, options: AxiosRequestConfig = {}) =>\n      request<TResponseType>(url, 'delete', options),\n    get: <TResponseType>(url: string, options: AxiosRequestConfig = {}) =>\n      request<TResponseType>(url, 'get', options),\n    head: <TResponseType>(url: string, options: AxiosRequestConfig = {}) =>\n      request<TResponseType>(url, 'head', options),\n    patch: <TResponseType>(\n      url: string,\n      data: any = null,\n      options: RequestGeneratorWithoutDataOptions = {}\n    ) => request<TResponseType>(url, 'patch', { ...options, data }),\n    options: <TResponseType>(url: string, options: AxiosRequestConfig = {}) =>\n      request<TResponseType>(url, 'options', options),\n    post: <TResponseType>(\n      url: string,\n      data: any = null,\n      options: RequestGeneratorWithoutDataOptions = {}\n    ) => request<TResponseType>(url, 'post', { ...options, data }),\n    put: <TResponseType>(\n      url: string,\n      data: any = null,\n      options: RequestGeneratorWithoutDataOptions = {}\n    ) => request<TResponseType>(url, 'put', { ...options, data }),\n  };\n\n  useEffect(\n    () => () => {\n      const { cancelAutomatically } = mergedHookOptions;\n      if (cancelAutomatically) {\n        canceler(REQUEST_AUTOMATICALLY_CANCELLED);\n      }\n    },\n    []\n  );\n\n  return [generators, () => canceler(REQUEST_MANUALLY_CANCELLED)];\n};\n","import { AxiosError, AxiosRequestConfig } from 'axios';\nimport { IAxiosRetryConfig } from 'axios-retry';\nimport {\n  QueryKey,\n  useQuery,\n  UseQueryOptions,\n  UseQueryResult,\n} from '@tanstack/react-query';\nimport { Axios, HookOptions, useAxiosRequest } from './useAxiosRequest';\n\nexport type QueryOptions<TDataType> = Omit<\n  UseQueryOptions<TDataType, AxiosError>,\n  'queryFn' | 'queryKey'\n>;\n\nexport const useAxiosQuery = <TDataType>(\n  name: QueryKey,\n  queryFn: (\n    axios: Axios,\n    canceller: () => void\n  ) => Promise<TDataType>,\n  queryOptions: QueryOptions<TDataType> = {},\n  axiosOptions: AxiosRequestConfig = {},\n  retryOptions: IAxiosRetryConfig = {},\n  axiosRequestHookOptions: HookOptions = {}\n): [\n  TDataType | undefined,\n  Omit<UseQueryResult<TDataType, AxiosError>, 'data'>\n] => {\n  const mergedQueryOptions: QueryOptions<TDataType> = {\n    refetchOnWindowFocus: false,\n    ...queryOptions,\n  }\n\n  const [request, canceller] = useAxiosRequest(axiosOptions, retryOptions, axiosRequestHookOptions);\n\n  const { data, ...otherProps } = useQuery<TDataType, AxiosError>(\n    name,\n    () => queryFn(request, canceller),\n    mergedQueryOptions\n  );\n\n  return [data, otherProps];\n};\n"],"names":[],"mappings":"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"}